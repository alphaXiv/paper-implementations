Metadata-Version: 2.4
Name: omnidocbench-evals
Version: 0.1.0
Summary: Evaluation scripts for OmniDocBench OCR models
Author: alphaXiv
License: MIT
Description-Content-Type: text/markdown
Requires-Dist: PyMuPDF
Requires-Dist: tqdm
Requires-Dist: jupyter
Requires-Dist: pandas
Requires-Dist: matplotlib
Requires-Dist: datasets
Provides-Extra: deepseek-ocr
Requires-Dist: torch==2.6.0; extra == "deepseek-ocr"
Requires-Dist: torchvision==0.21.0; extra == "deepseek-ocr"
Requires-Dist: torchaudio==2.6.0; extra == "deepseek-ocr"
Requires-Dist: vllm@ https://github.com/vllm-project/vllm/releases/download/v0.8.5/vllm-0.8.5+cu118-cp38-abi3-manylinux1_x86_64.whl ; extra == "deepseek-ocr"
Requires-Dist: transformers; extra == "deepseek-ocr"
Requires-Dist: tokenizers; extra == "deepseek-ocr"
Requires-Dist: img2pdf; extra == "deepseek-ocr"
Requires-Dist: einops; extra == "deepseek-ocr"
Requires-Dist: easydict; extra == "deepseek-ocr"
Requires-Dist: addict; extra == "deepseek-ocr"
Requires-Dist: Pillow; extra == "deepseek-ocr"
Requires-Dist: numpy; extra == "deepseek-ocr"
Provides-Extra: olmocr
Requires-Dist: cached-path; extra == "olmocr"
Requires-Dist: smart_open; extra == "olmocr"
Requires-Dist: pypdf>=5.2.0; extra == "olmocr"
Requires-Dist: pypdfium2; extra == "olmocr"
Requires-Dist: cryptography; extra == "olmocr"
Requires-Dist: lingua-language-detector; extra == "olmocr"
Requires-Dist: Pillow; extra == "olmocr"
Requires-Dist: ftfy; extra == "olmocr"
Requires-Dist: bleach; extra == "olmocr"
Requires-Dist: markdown2; extra == "olmocr"
Requires-Dist: markdownify; extra == "olmocr"
Requires-Dist: filelock; extra == "olmocr"
Requires-Dist: orjson; extra == "olmocr"
Requires-Dist: requests; extra == "olmocr"
Requires-Dist: zstandard; extra == "olmocr"
Requires-Dist: boto3; extra == "olmocr"
Requires-Dist: httpx; extra == "olmocr"
Requires-Dist: torch>=2.7.0; extra == "olmocr"
Requires-Dist: transformers==4.55.2; extra == "olmocr"
Requires-Dist: beaker-py; extra == "olmocr"
Provides-Extra: chandra-ocr
Requires-Dist: chandra-ocr; extra == "chandra-ocr"
Provides-Extra: omnidocbench
Requires-Dist: aiohappyeyeballs==2.4.3; extra == "omnidocbench"
Requires-Dist: aiohttp==3.10.11; extra == "omnidocbench"
Requires-Dist: aiosignal==1.3.1; extra == "omnidocbench"
Requires-Dist: apted==1.0.3; extra == "omnidocbench"
Requires-Dist: argon2-cffi==21.3.0; extra == "omnidocbench"
Requires-Dist: argon2-cffi-bindings==21.2.0; extra == "omnidocbench"
Requires-Dist: async-timeout==5.0.1; extra == "omnidocbench"
Requires-Dist: attrs==24.2.0; extra == "omnidocbench"
Requires-Dist: backcall==0.2.0; extra == "omnidocbench"
Requires-Dist: beautifulsoup4==4.11.1; extra == "omnidocbench"
Requires-Dist: bleach==5.0.1; extra == "omnidocbench"
Requires-Dist: category-encoders==2.5.0; extra == "omnidocbench"
Requires-Dist: certifi==2024.8.30; extra == "omnidocbench"
Requires-Dist: charset-normalizer==3.4.0; extra == "omnidocbench"
Requires-Dist: click==8.1.7; extra == "omnidocbench"
Requires-Dist: contourpy==1.1.1; extra == "omnidocbench"
Requires-Dist: cycler==0.12.1; extra == "omnidocbench"
Requires-Dist: datasets==3.1.0; extra == "omnidocbench"
Requires-Dist: debugpy==1.6.3; extra == "omnidocbench"
Requires-Dist: decorator==5.1.1; extra == "omnidocbench"
Requires-Dist: defusedxml==0.7.1; extra == "omnidocbench"
Requires-Dist: dill==0.3.8; extra == "omnidocbench"
Requires-Dist: entrypoints==0.4; extra == "omnidocbench"
Requires-Dist: evaluate==0.4.3; extra == "omnidocbench"
Requires-Dist: fastjsonschema==2.16.2; extra == "omnidocbench"
Requires-Dist: filelock==3.16.1; extra == "omnidocbench"
Requires-Dist: fonttools==4.55.0; extra == "omnidocbench"
Requires-Dist: frozenlist==1.5.0; extra == "omnidocbench"
Requires-Dist: fsspec==2024.9.0; extra == "omnidocbench"
Requires-Dist: func-timeout==4.3.5; extra == "omnidocbench"
Requires-Dist: huggingface-hub==0.26.2; extra == "omnidocbench"
Requires-Dist: idna==3.10; extra == "omnidocbench"
Requires-Dist: importlib_resources==6.4.5; extra == "omnidocbench"
Requires-Dist: ipykernel==6.16.0; extra == "omnidocbench"
Requires-Dist: ipython==7.34.0; extra == "omnidocbench"
Requires-Dist: ipython-genutils==0.2.0; extra == "omnidocbench"
Requires-Dist: ipywidgets==7.7.2; extra == "omnidocbench"
Requires-Dist: jedi==0.18.1; extra == "omnidocbench"
Requires-Dist: Jinja2==3.1.2; extra == "omnidocbench"
Requires-Dist: joblib==1.2.0; extra == "omnidocbench"
Requires-Dist: jsonpickle==2.2.0; extra == "omnidocbench"
Requires-Dist: jupyterlab-pygments==0.2.2; extra == "omnidocbench"
Requires-Dist: jupyterlab-widgets==1.1.1; extra == "omnidocbench"
Requires-Dist: kiwisolver==1.4.7; extra == "omnidocbench"
Requires-Dist: Levenshtein==0.25.1; extra == "omnidocbench"
Requires-Dist: loguru==0.7.2; extra == "omnidocbench"
Requires-Dist: lxml==4.9.1; extra == "omnidocbench"
Requires-Dist: markdown-it-py==3.0.0; extra == "omnidocbench"
Requires-Dist: matplotlib==3.7.5; extra == "omnidocbench"
Requires-Dist: matplotlib-inline==0.1.6; extra == "omnidocbench"
Requires-Dist: mdurl==0.1.2; extra == "omnidocbench"
Requires-Dist: mistune==2.0.4; extra == "omnidocbench"
Requires-Dist: mmeval==0.2.1; extra == "omnidocbench"
Requires-Dist: multidict==6.1.0; extra == "omnidocbench"
Requires-Dist: multiprocess==0.70.16; extra == "omnidocbench"
Requires-Dist: nbclient==0.6.8; extra == "omnidocbench"
Requires-Dist: nbconvert==7.0.0; extra == "omnidocbench"
Requires-Dist: nbformat==5.6.1; extra == "omnidocbench"
Requires-Dist: nest-asyncio==1.5.5; extra == "omnidocbench"
Requires-Dist: nltk==3.9.1; extra == "omnidocbench"
Requires-Dist: notebook==6.4.12; extra == "omnidocbench"
Requires-Dist: numpy==1.24.4; extra == "omnidocbench"
Requires-Dist: opencv-python==4.10.0.84; extra == "omnidocbench"
Requires-Dist: packaging==24.2; extra == "omnidocbench"
Requires-Dist: pandas==2.0.3; extra == "omnidocbench"
Requires-Dist: pandocfilters==1.5.0; extra == "omnidocbench"
Requires-Dist: parso==0.8.3; extra == "omnidocbench"
Requires-Dist: patsy==0.5.2; extra == "omnidocbench"
Requires-Dist: pexpect==4.8.0; extra == "omnidocbench"
Requires-Dist: pickleshare==0.7.5; extra == "omnidocbench"
Requires-Dist: pillow==10.4.0; extra == "omnidocbench"
Requires-Dist: pkgutil_resolve_name==1.3.10; extra == "omnidocbench"
Requires-Dist: plotly==5.5.0; extra == "omnidocbench"
Requires-Dist: plum-dispatch==1.7.4; extra == "omnidocbench"
Requires-Dist: prometheus-client==0.14.1; extra == "omnidocbench"
Requires-Dist: prompt-toolkit==3.0.31; extra == "omnidocbench"
Requires-Dist: propcache==0.2.0; extra == "omnidocbench"
Requires-Dist: psutil==5.9.2; extra == "omnidocbench"
Requires-Dist: ptyprocess==0.7.0; extra == "omnidocbench"
Requires-Dist: pyarrow==17.0.0; extra == "omnidocbench"
Requires-Dist: Pygments==2.18.0; extra == "omnidocbench"
Requires-Dist: pylatexenc==3.0a30; extra == "omnidocbench"
Requires-Dist: PyNomaly==0.3.4; extra == "omnidocbench"
Requires-Dist: pyparsing==3.1.4; extra == "omnidocbench"
Requires-Dist: pyrsistent==0.18.1; extra == "omnidocbench"
Requires-Dist: python-dateutil==2.9.0.post0; extra == "omnidocbench"
Requires-Dist: python-utils==3.3.3; extra == "omnidocbench"
Requires-Dist: pytz==2024.2; extra == "omnidocbench"
Requires-Dist: PyYAML==6.0.2; extra == "omnidocbench"
Requires-Dist: rapidfuzz==3.9.7; extra == "omnidocbench"
Requires-Dist: regex==2024.11.6; extra == "omnidocbench"
Requires-Dist: requests==2.32.3; extra == "omnidocbench"
Requires-Dist: rich==13.9.4; extra == "omnidocbench"
Requires-Dist: scikit-learn==1.1.2; extra == "omnidocbench"
Requires-Dist: scipy==1.10.1; extra == "omnidocbench"
Requires-Dist: Send2Trash==1.8.0; extra == "omnidocbench"
Requires-Dist: six==1.16.0; extra == "omnidocbench"
Requires-Dist: soupsieve==2.3.2.post1; extra == "omnidocbench"
Requires-Dist: statsmodels==0.13.2; extra == "omnidocbench"
Requires-Dist: tabulate==0.9.0; extra == "omnidocbench"
Requires-Dist: tenacity==8.1.0; extra == "omnidocbench"
Requires-Dist: terminado==0.15.0; extra == "omnidocbench"
Requires-Dist: threadpoolctl==3.1.0; extra == "omnidocbench"
Requires-Dist: tinycss2==1.1.1; extra == "omnidocbench"
Requires-Dist: tornado==6.2; extra == "omnidocbench"
Requires-Dist: tqdm==4.67.1; extra == "omnidocbench"
Requires-Dist: typing_extensions==4.12.2; extra == "omnidocbench"
Requires-Dist: tzdata==2024.2; extra == "omnidocbench"
Requires-Dist: urllib3==2.2.3; extra == "omnidocbench"
Requires-Dist: webencodings==0.5.1; extra == "omnidocbench"
Requires-Dist: widgetsnbextension==3.6.1; extra == "omnidocbench"
Requires-Dist: xxhash==3.5.0; extra == "omnidocbench"
Requires-Dist: yarl==1.15.2; extra == "omnidocbench"
Requires-Dist: zipp==3.20.2; extra == "omnidocbench"
Requires-Dist: pycocotools==2.0.7; extra == "omnidocbench"
Requires-Dist: scikit-image==0.21.0; extra == "omnidocbench"

# DeepSeek-OCR vs OLMOCR-2 Evaluation on OmniDocBench

This repository provides a comparative evaluation of **DeepSeek-OCR** and **OLMOCR-2** on the **OmniDocBench** benchmark. The evaluation assesses document parsing capabilities across text, formulas, tables, and reading order.

## Overview

- **DeepSeek-OCR**: A vLLM-based multimodal pipeline for document understanding.
- **OLMOCR-2**: An efficient OCR system using open visual language models.
- **OmniDocBench**: A comprehensive benchmark with 1,355 annotated PDF pages covering diverse document types.

## Quick Start

The easiest way to set up and run the complete evaluation is using the automated speedrun script:

(Use 1xH100 80GB SXM and we used Lambda Labs Lambda Stack 22.04 image for this setup)

```bash
./speedrun.sh [language_filter]
```

**Options:**
- `all` - Evaluate on all languages (default)
- `english` - Evaluate on English documents only
- `simplified_chinese` - Evaluate on simplified Chinese documents only

**Example:**
```bash
./speedrun.sh all
```

This script will automatically:
1. Download the OmniDocBench dataset
2. Set up all three OCR environments (DeepSeek-OCR, OLMOCR-2, Chandra OCR)
3. Run inference on all models
4. Execute comprehensive evaluation
5. Generate comparison results

### Environment Requirements

- CUDA 11.8+ with torch 2.6.0+
- Conda/Miniconda installed
- At least 60GB free disk space for models and data
- For Chandra OCR: `DATALAB_API_KEY` environment variable (optional)
## Results

After evaluation, results are stored in `OmniDocBench/result/` and a summary CSV is generated at `results_${LANGUAGE_FILTER}.csv`.

The speedrun script will automatically generate:
- **CSV Summary**: `results_all.csv` (or `results_english.csv`, `results_simplified_chinese.csv` based on language filter)
- **Detailed Metrics**: `src/omnidocbench_evals/OmniDocBench/result/`
- **Model Outputs**: 
  - DeepSeek-OCR: `outputs/deepseek_ocr/`
  - OLMOCR-2: `outputs/olmocr_workspace/markdown/`
  - Chandra OCR: `outputs/chandra_ocr/`

### Key Metrics

- **Text Accuracy**: Normalized edit distance
- **Formula Accuracy**: Edit distance score
- **Table TEDS Score**: Table structure evaluation
- **Reading Order Accuracy**: Document flow evaluation
- **Overall Score**: `((1 - text_edit) × 100 + table_teds + (1 - edit_distance) × 100) / 3`

See [`REPORT.md`](REPORT.md) for detailed results and visualizations from our evaluation runs.

## Troubleshooting

### CUDA/Memory Issues
- Ensure CUDA 11.8+ is installed: `nvidia-smi`
- Check available GPU memory: `nvidia-smi`
- Reduce batch size if out of memory

### Dataset Download Issues
- Set HuggingFace token: `export HF_TOKEN="your_token_here"`
- Check internet connection and rate limits

### Environment Conflicts
- Each OCR system runs in a separate conda environment to avoid conflicts
- Do not mix environments manually

## Data

The dataset is automatically downloaded from [OmniDocBench on HuggingFace](https://huggingface.co/datasets/opendatalab/OmniDocBench) to `data/OmniDocBench/` when running the speedrun script.

